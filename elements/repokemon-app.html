<link rel="import" href="/bower_components/iron-ajax/iron-ajax.html">
<dom-module id="repokemon-app">
	<template>
		<style>
			:host {
				display: block;
			}
			#list{
			  margin: 0;
			  padding: 0;
			  list-style: none;
			  text-align: center;
			  display: flex;
			  flex-wrap: wrap;
			}
			#list li{
			  display: inline-flex;
			  text-align: center;
			  width: 120px;
			  vertical-align: top;
			  flex-grow: 1;
			  flex-direction: column;
			  align-items: center;
			}
			#list li.unavailable{
			  opacity: .35;
			}
			#list li a{
			  display: block;
			  color: inherit;
			  text-decoration: none;
			  border-radius: 5px;
			  transition: background-color .3s;
			  padding: 10px 15px;
			}
			#list li a:hover{
			  background-color: #FAFCA9;
			}
			#list li h2{
			  font-size: 1em;
			  margin: 0;
			  padding: 0;
			}
			#list li img{
			  transform: scale(.9, .9);
			  transition: transform .3s;
			}
			#list li a:hover img{
			  transform: scale(1, 1);
			}
			#list li a .metadata{
			  opacity: .4;
			  font-size: .7em;
			}
			#list li a:hover .metadata{
			  opacity: .9;
			}			
		</style>
		
	    <iron-ajax
	       auto
	       url="/data/repokemon.json"
	       handle-as="json"
	       last-response="{{ajaxResponse}}"></iron-ajax>

	    <ul id="list">
		   	<template is="dom-repeat" items="[[ajaxResponse]]" initial-count="20">
		   		<template is="dom-if" if="{{item.repo}}">
					<li class="available">
						<a href="https://github.com/{{repo.full_name}}" target="_blank">
							<img src="https://assets.pokemon.com/assets/cms2/img/pokedex/detail/{{item.id}}.png" width="100" height="100" alt="">
							<h2>[[item.name]]</h2>
							<div class="metadata">{{repoDesc(item.repo.desc)}}</div>
							<div class="metadata">‚≠êÔ∏è {{item.repo.stars}} üç¥ {{item.repo.forks}}</div>
						</a>
					</li>	   			
		   		</template>
		   		<template is="dom-if" if="{{!item.repo}}">
					<li class="unavailable">
					    <img src="https://assets.pokemon.com/assets/cms2/img/pokedex/detail/{{item.id}}.png" width="100" height="100" alt="">
					    <h2>[[item.name]]</h2>
					</li>
		   		</template>	   		
		   	</template>
	   	</ul>

	</template>
	<script>
		Polymer({
			is: 'repokemon-app',

			repoDesc: function(repo){
			    var longDesc = repo || '';
			    var descLimit = 70;
			    var veryLongDesc = longDesc.length > descLimit;
			    return veryLongDesc ? longDesc.slice(0, descLimit-1) + '‚Ä¶' : longDesc;				
			}
		});
	</script>
</dom-module>